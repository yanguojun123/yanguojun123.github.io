<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-社区医院选址问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/10/社区医院选址问题/" class="article-date">
  <time datetime="2018-06-10T02:12:26.000Z" itemprop="datePublished">2018-06-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/10/社区医院选址问题/">社区医院选址问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/10/社区医院选址问题/" data-id="cjl7x6cds0000qgumts4uup10" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-基于拓扑排序的排课程序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/10/基于拓扑排序的排课程序/" class="article-date">
  <time datetime="2018-06-10T01:04:03.000Z" itemprop="datePublished">2018-06-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/10/基于拓扑排序的排课程序/">基于拓扑排序的排课程序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、题目描述"><a href="#一、题目描述" class="headerlink" title="一、题目描述"></a>一、题目描述</h3><p>  某学院有n门课程，（i，j）表示课程i是课程j的先行课，及课程i必须在课程j的之前的学期开设。对任意给出的仙子那个课解s={(1,3),(2,4),(3,5),(4,6),(3,7),…},至少需要安排多少个学期？给出每个学期的课程清单。</p>
<h3 id="二、程序思路"><a href="#二、程序思路" class="headerlink" title="二、程序思路"></a>二、程序思路</h3><p>  分析题目能清楚地发现此题与拓扑排序有很大的关系，拓扑排序的层数就是学期数，每个学期的课程就是每一层的点。所以只需要在拓扑排序的程序上改改就好了。</p>
<h3 id="三、具体实现"><a href="#三、具体实现" class="headerlink" title="三、具体实现"></a>三、具体实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> linkedDgraph1::course(<span class="keyword">int</span> **b)<span class="comment">//传入的为保存结果的二维数组</span></span><br><span class="line">&#123;   </span><br><span class="line">	<span class="keyword">int</span> number=<span class="number">0</span>;<span class="comment">//学期数 </span></span><br><span class="line">	<span class="keyword">int</span> n=verticeNumber;<span class="comment">//顶点个数 </span></span><br><span class="line">	<span class="keyword">int</span> *indegree=<span class="keyword">new</span> <span class="keyword">int</span>[num1+<span class="number">1</span>];<span class="comment">//顶点的入度数组 </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=num1;i++)<span class="comment">//保存入度 </span></span><br><span class="line">	indegree[i]=inDegree(i);</span><br><span class="line">	<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; astack(<span class="number">10000</span>);<span class="comment">//声明栈 </span></span><br><span class="line">	<span class="keyword">while</span>(n!=<span class="number">0</span>)</span><br><span class="line">	&#123;      <span class="keyword">int</span> j=<span class="number">0</span>;</span><br><span class="line">		 <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=num1;i++)<span class="comment">//遍历将入度为零的点入栈 </span></span><br><span class="line">		&#123;    </span><br><span class="line">			<span class="keyword">if</span>(indegree[i]==<span class="number">0</span>)</span><br><span class="line">			&#123; </span><br><span class="line">			  b[number][j++]=i;<span class="comment">//保存此点 </span></span><br><span class="line">			  <span class="comment">//cout&lt;&lt;i&lt;&lt;" ";</span></span><br><span class="line">	          astack.push(i);  <span class="comment">//入栈 </span></span><br><span class="line">		    &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		   number++;<span class="comment">//前一学期的课程已完 </span></span><br><span class="line">		   <span class="comment">//cout&lt;&lt;number&lt;&lt;" ";</span></span><br><span class="line">		   <span class="keyword">while</span>(!astack.empty())</span><br><span class="line">			&#123;  <span class="keyword">int</span> t=astack.top();</span><br><span class="line">			   n--;</span><br><span class="line">			 <span class="comment">//  cout&lt;&lt;verticeNumber&lt;&lt;" ";</span></span><br><span class="line">			   indegree[t]=<span class="number">-1</span>;</span><br><span class="line">			   astack.pop();</span><br><span class="line">			   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=num1;i++)<span class="comment">//更新各顶点的入度 </span></span><br><span class="line">			     <span class="keyword">if</span>(existsEdge(t,i))</span><br><span class="line">			      indegree[i]--;	</span><br><span class="line">			&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="四、结果展示"><a href="#四、结果展示" class="headerlink" title="四、结果展示"></a>四、结果展示</h3><p><img src="/2018/06/10/基于拓扑排序的排课程序/图片2.png" alt=""></p>
<p><img src="/2018/06/10/基于拓扑排序的排课程序/图片1.png" alt="1528593893057"></p>
<h3 id="五、说明"><a href="#五、说明" class="headerlink" title="五、说明"></a>五、说明</h3><p>本程序所用图的结构为邻接链表。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/10/基于拓扑排序的排课程序/" data-id="cjl7x6cew0003qguminw9f1vh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/拓扑排序-有向图/">拓扑排序 有向图</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android手指个数识别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/04/Android手指个数识别/" class="article-date">
  <time datetime="2018-06-04T02:40:57.000Z" itemprop="datePublished">2018-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/04/Android手指个数识别/">Android手指个数识别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、在Android-Studio导入opencv-库。"><a href="#一、在Android-Studio导入opencv-库。" class="headerlink" title="一、在Android Studio导入opencv 库。"></a>一、在Android Studio导入opencv 库。</h3><p>  这里直接给个链接：<a href="https://blog.csdn.net/qq402335257/article/details/52884525" target="_blank" rel="noopener"></a></p>
<p> 一个opencv的学习网站：<a href="http://www.opencv.org.cn/" target="_blank" rel="noopener"></a></p>
<h3 id="二、建立项目"><a href="#二、建立项目" class="headerlink" title="二、建立项目"></a>二、建立项目</h3><p>1.整体思路：</p>
<p>（1）：点击拍照，调用手机摄像头拍照并保存。</p>
<p>（2）：调用刚才拍的照片进行处理。</p>
<p>（3）：在界面显示结果。</p>
<p>2.具体步骤：</p>
<p>（1）调用手机摄像头拍照保存并读取的相关权限：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.CAMERA"</span> /&gt;</span><br><span class="line"><span class="comment">//摄像头权限</span></span><br><span class="line">&lt;uses-feature android:name=<span class="string">"android.hardware.camera"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span> /&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>（2）界面：包含一个拍照按钮，一个图片展示框和一个文本输出显示手指的个数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:text=<span class="string">"照相"</span></span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_below=<span class="string">"@+id/btn_gray_process"</span></span><br><span class="line">    android:layout_alignStart=<span class="string">"@+id/btn_gray_process"</span></span><br><span class="line">    android:id=<span class="string">"@+id/take_photo"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;ImageView</span><br><span class="line">    android:id=<span class="string">"@+id/picture"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_alignParentBottom=<span class="string">"true"</span></span><br><span class="line">    android:layout_centerHorizontal=<span class="string">"true"</span></span><br><span class="line">    android:layout_marginBottom=<span class="string">"16dp"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;TextView</span><br><span class="line">    android:text=<span class="string">"手指个数"</span></span><br><span class="line">    android:layout_width=<span class="string">"100dp"</span></span><br><span class="line">    android:layout_height=<span class="string">"50dp"</span></span><br><span class="line">    android:layout_alignBottom=<span class="string">"@+id/take_photo"</span></span><br><span class="line">    android:layout_alignParentEnd=<span class="string">"true"</span></span><br><span class="line">    android:layout_marginEnd=<span class="string">"91dp"</span></span><br><span class="line">    android:id=<span class="string">"@+id/textView"</span></span><br><span class="line">    android:layout_alignParentTop=<span class="string">"true"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>（3）</p>
<h3 id="三、具体实现代码："><a href="#三、具体实现代码：" class="headerlink" title="三、具体实现代码："></a>三、具体实现代码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.yanhuojun.handgesture1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.net.Uri;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.provider.MediaStore;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.yanhuojun.handgesture1.R;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.opencv.android.BaseLoaderCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.opencv.android.LoaderCallbackInterface;</span><br><span class="line"><span class="keyword">import</span> org.opencv.android.OpenCVLoader;</span><br><span class="line"><span class="keyword">import</span> org.opencv.android.Utils;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.Core;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.CvType;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.Mat;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.MatOfInt4;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.MatOfPoint;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.MatOfPoint2f;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.Point;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.Scalar;</span><br><span class="line"><span class="keyword">import</span> org.opencv.core.Size;</span><br><span class="line"><span class="keyword">import</span> org.opencv.imgcodecs.Imgcodecs;</span><br><span class="line"><span class="keyword">import</span> org.opencv.imgproc.Imgproc;</span><br><span class="line"><span class="keyword">import</span> org.opencv.imgproc.Moments;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.abs;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.opencv.core.CvType.CV_8UC3;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.opencv.imgproc.Imgproc.THRESH_BINARY;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.opencv.imgproc.Imgproc.circle;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.opencv.imgproc.Imgproc.line;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.opencv.imgproc.Imgproc.moments;</span><br><span class="line"></span><br><span class="line"><span class="comment">//public class MainActivity extends AppCompatActivity &#123;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TAKE_PHOTO = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//public static final int CROP_PHOTO = 2;</span></span><br><span class="line">    <span class="keyword">private</span> TextView textView;</span><br><span class="line">    <span class="keyword">private</span> Button takephoto;</span><br><span class="line">    <span class="keyword">private</span> ImageView picture;</span><br><span class="line">    <span class="keyword">private</span> Uri imageUri;</span><br><span class="line">    <span class="keyword">double</span> treash=<span class="number">100</span>;</span><br><span class="line">    Mat imageMat;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"OCVSample::Activity"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BaseLoaderCallback mLoaderCallback = <span class="keyword">new</span> BaseLoaderCallback(<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onManagerConnected</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">                <span class="keyword">case</span> LoaderCallbackInterface.SUCCESS:</span><br><span class="line">                &#123;</span><br><span class="line">                    Log.i(TAG, <span class="string">"OpenCV loaded successfully"</span>);</span><br><span class="line">                    imageMat=<span class="keyword">new</span> Mat();</span><br><span class="line">                &#125; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">super</span>.onManagerConnected(status);</span><br><span class="line">                &#125; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        <span class="keyword">if</span> (!OpenCVLoader.initDebug()) &#123;</span><br><span class="line">            Log.d(<span class="string">"OpenCV"</span>, <span class="string">"Internal OpenCV library not found. Using OpenCV Manager for initialization"</span>);</span><br><span class="line">            OpenCVLoader.initAsync(OpenCVLoader.OPENCV_VERSION_2_4_10, <span class="keyword">this</span>, mLoaderCallback);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(<span class="string">"OpenCV"</span>, <span class="string">"OpenCV library found inside package. Using it!"</span>);</span><br><span class="line">            mLoaderCallback.onManagerConnected(LoaderCallbackInterface.SUCCESS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        takephoto = (Button)findViewById(R.id.take_photo);</span><br><span class="line">        textView =(TextView) findViewById(R.id.textView);</span><br><span class="line">        picture   = (ImageView)findViewById(R.id.picture);</span><br><span class="line">        takephoto.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                File outputImage = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory(), <span class="string">"output_image.jpg"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (outputImage.exists()) &#123;</span><br><span class="line">                        outputImage.delete();</span><br><span class="line">                    &#125;</span><br><span class="line">                    outputImage.createNewFile();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                imageUri = Uri.fromFile(outputImage);</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(<span class="string">"android.media.action.IMAGE_CAPTURE"</span>);<span class="comment">//调用系统相机拍照</span></span><br><span class="line">                intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri);</span><br><span class="line">                startActivityForResult(intent, TAKE_PHOTO);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (requestCode)&#123;</span><br><span class="line">            <span class="keyword">case</span> TAKE_PHOTO:</span><br><span class="line">                <span class="comment">//if (resultCode == RESULT_OK)&#123;</span></span><br><span class="line">                <span class="comment">//Intent intent = new Intent("com.android.camera.action.CROP");</span></span><br><span class="line">                <span class="comment">//intent.setDataAndType(imageUri, "image/*");</span></span><br><span class="line">                <span class="comment">// intent.putExtra("scale", true);</span></span><br><span class="line">                <span class="comment">//intent.putExtra(MediaStore.EXTRA_OUTPUT,imageUri);</span></span><br><span class="line">                <span class="comment">//startActivityForResult(intent, CROP_PHOTO);</span></span><br><span class="line">                <span class="comment">//&#125;</span></span><br><span class="line">                <span class="comment">//break;</span></span><br><span class="line">                <span class="comment">//case CROP_PHOTO:</span></span><br><span class="line">                <span class="keyword">if</span> (resultCode == RESULT_OK)&#123;</span><br><span class="line">                    <span class="keyword">try</span>&#123;</span><br><span class="line">                        <span class="comment">//获取原图</span></span><br><span class="line">                            Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(imageUri));</span><br><span class="line">                            picture.setImageBitmap(bitmap);<span class="comment">//设置显示图像</span></span><br><span class="line">                            <span class="comment">//图像处理</span></span><br><span class="line">                            Mat mat_src = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);<span class="comment">//获取原图(8位无符号的四通道，带透明的RGB图像)</span></span><br><span class="line">                            Utils.bitmapToMat(bitmap, mat_src);<span class="comment">//将bitmap转化成mat</span></span><br><span class="line">                            Mat mat_gray = <span class="keyword">new</span> Mat(mat_src.cols(), mat_src.rows(), CvType.CV_8UC1);<span class="comment">//灰度图，单通道</span></span><br><span class="line">                            Imgproc.cvtColor(mat_src, mat_gray, Imgproc.COLOR_BGRA2GRAY, <span class="number">1</span>);<span class="comment">//转变颜色</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//-------------------------------------------------------------------</span></span><br><span class="line">                            Mat frame = <span class="keyword">new</span> Mat(bitmap.getHeight(), bitmap.getWidth(), CvType.CV_8UC4);<span class="comment">//取出原图</span></span><br><span class="line">                            mat_src.copyTo(frame);<span class="comment">//复制，不会牵连改变</span></span><br><span class="line"></span><br><span class="line">                            Mat frameHSV = <span class="keyword">new</span> Mat(mat_src.cols(), mat_src.rows(), CV_8UC3);<span class="comment">//三通道的RGB图像</span></span><br><span class="line">                            ;   <span class="comment">// hsv空间(色调，饱和度，明度)</span></span><br><span class="line">                            Mat mask = <span class="keyword">new</span> Mat(mat_src.cols(), mat_src.rows(), CvType.CV_8UC1);</span><br><span class="line">                            Mat dst = <span class="keyword">new</span> Mat(mat_src.cols(), mat_src.rows(), CV_8UC3); <span class="comment">// 输出图像</span></span><br><span class="line">                            <span class="comment">//dst.copyTo(frame);</span></span><br><span class="line">                            <span class="comment">// 中值滤波，去除椒盐噪声</span></span><br><span class="line">                            Imgproc.medianBlur(frame, frame, <span class="number">5</span>);</span><br><span class="line">                            Imgproc.cvtColor(frame, frameHSV, Imgproc.COLOR_RGB2HSV, <span class="number">3</span>);<span class="comment">//把frame的颜色空间转换后复制到frameHSV</span></span><br><span class="line">                            Mat dstTemp1 = <span class="keyword">new</span> Mat(mat_src.cols(), mat_src.rows(), CvType.CV_8UC1);</span><br><span class="line">                            Mat dstTemp2 = <span class="keyword">new</span> Mat(mat_src.cols(), mat_src.rows(), CvType.CV_8UC1);</span><br><span class="line">                            <span class="comment">// 对HSV空间进行量化，得到二值图像，亮的部分为手的形状</span></span><br><span class="line">                            Core.inRange(frameHSV, <span class="keyword">new</span> Scalar(<span class="number">0</span>, <span class="number">30</span>, <span class="number">30</span>), <span class="keyword">new</span> Scalar(<span class="number">40</span>, <span class="number">170</span>, <span class="number">256</span>), dstTemp1);<span class="comment">//比较三个通道中的元素是否在相应的区间类，不在的画的则改成255</span></span><br><span class="line">                            Core.inRange(frameHSV, <span class="keyword">new</span> Scalar(<span class="number">156</span>, <span class="number">30</span>, <span class="number">30</span>), <span class="keyword">new</span> Scalar(<span class="number">180</span>, <span class="number">170</span>, <span class="number">256</span>), dstTemp2);</span><br><span class="line">                            Core.bitwise_or(dstTemp1, dstTemp2, mask);<span class="comment">//对前面的两张图片（二值图像）进行异或处理，并将其结果给第三章图</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 形态学操作，去除噪声，并使手的边界更加清晰</span></span><br><span class="line">                            Mat element = Imgproc.getStructuringElement(Imgproc.MORPH_RECT, <span class="keyword">new</span> Size(<span class="number">3</span>, <span class="number">3</span>));<span class="comment">//定义一个合适大小的核</span></span><br><span class="line">                            Imgproc.erode(mask, mask, element);<span class="comment">//扩大暗区，腐蚀</span></span><br><span class="line">                            Imgproc.morphologyEx(mask, mask, Imgproc.MORPH_OPEN, element);<span class="comment">//对输入图像执行开运算</span></span><br><span class="line">                            Imgproc.dilate(mask, mask, element);<span class="comment">//扩大亮区，膨胀</span></span><br><span class="line">                            Imgproc.morphologyEx(mask, mask, Imgproc.MORPH_CLOSE, element);<span class="comment">//执行闭运算</span></span><br><span class="line"></span><br><span class="line">                            frame.copyTo(dst, mask);</span><br><span class="line"></span><br><span class="line">                           List&lt;MatOfPoint&gt; contourList = <span class="keyword">new</span> ArrayList&lt;MatOfPoint&gt;();</span><br><span class="line">                        Vector&lt;MatOfPoint&gt; contours=<span class="keyword">new</span> Vector&lt;MatOfPoint&gt;();</span><br><span class="line">                        Vector&lt;Vector&lt;Point&gt;&gt; con=<span class="keyword">new</span> Vector&lt;Vector&lt;Point&gt;&gt;();</span><br><span class="line"></span><br><span class="line">                        MatOfInt4 hierarchy=<span class="keyword">new</span> MatOfInt4();</span><br><span class="line">                         <span class="comment">//Imgproc.Canny(mat_src,mask,mask,treash*2,3);</span></span><br><span class="line"><span class="comment">//                        // 得到手的轮廓</span></span><br><span class="line">                            Imgproc.findContours(mask, contours, hierarchy, Imgproc.RETR_EXTERNAL, Imgproc.CHAIN_APPROX_SIMPLE);</span><br><span class="line">                        <span class="comment">//List&lt;Moments&gt; mu=new ArrayList&lt;Moments&gt;(contourList.size()) ;</span></span><br><span class="line">                        <span class="comment">//mu.set(0,moments(contourList.get(0),true));</span></span><br><span class="line">                       <span class="comment">// for( int i = 0; i &lt; contourList.size(); i++ )</span></span><br><span class="line">                        <span class="comment">//&#123; mu.set(i,moments( contourList.get(i), false )); &#125;</span></span><br><span class="line">                        <span class="comment">///  计算中心矩:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        <span class="comment">//Log.e(TAG, "index=:"+index+"  counter.size="+contours.size()+"  area="+area);</span></span><br><span class="line"><span class="comment">//**********************************************************8</span></span><br><span class="line">                        <span class="comment">// dst = Mat::zeros( mask.size(), CV_8UC3 );</span></span><br><span class="line">                            <span class="comment">//Random r = new Random();</span></span><br><span class="line">                            <span class="comment">//int nContoursNum = contours.size();</span></span><br><span class="line">                           <span class="comment">//for (int i = 0; i &lt; nContoursNum; i++) &#123;</span></span><br><span class="line">                            <span class="comment">//   Imgproc.drawContours(dst, contours, i, new Scalar(r.nextInt(255), r.nextInt(255), r.nextInt(255)), -1);</span></span><br><span class="line">                          <span class="comment">// &#125;</span></span><br><span class="line">                        <span class="comment">//Point center=mc.get(0);</span></span><br><span class="line">                       <span class="comment">// Mat mat_gray1 = new Mat(mat_src.cols(), mat_src.rows(), CvType.CV_8UC1);//灰度图</span></span><br><span class="line">                        <span class="comment">//Imgproc.cvtColor(dst, mat_gray1, Imgproc.COLOR_BGRA2GRAY, 1);//转变颜色</span></span><br><span class="line">                            Moments moment = moments(mask,<span class="keyword">false</span>);</span><br><span class="line">                            Point center = <span class="keyword">new</span> Point(moment.m10 / moment.m00, moment.m01 / moment.m00);<span class="comment">//计算图形重心</span></span><br><span class="line">                            circle(dst, center, <span class="number">8</span>, <span class="keyword">new</span> Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), -<span class="number">1</span>);<span class="comment">//最后一位参数不确定*/</span></span><br><span class="line">                            <span class="comment">//-------------------------------------------------------------------</span></span><br><span class="line">                            <span class="comment">//图像显示</span></span><br><span class="line">                        Vector&lt;MatOfPoint2f&gt; newcont=<span class="keyword">new</span> Vector&lt;MatOfPoint2f&gt;();</span><br><span class="line">                        <span class="keyword">for</span>(MatOfPoint point : contours) &#123;</span><br><span class="line">                            MatOfPoint2f newPoint = <span class="keyword">new</span> MatOfPoint2f(point.toArray());</span><br><span class="line">                            newcont.add(newPoint);</span><br><span class="line">                        &#125;</span><br><span class="line">                        Vector&lt;MatOfPoint2f&gt; cont=<span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;newcont.size();i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            MatOfPoint2f first=newcont.get(i);</span><br><span class="line">                            MatOfPoint2f second=<span class="keyword">new</span> MatOfPoint2f();</span><br><span class="line">                            Imgproc.approxPolyDP(first,second, <span class="number">80</span>, <span class="keyword">true</span>);</span><br><span class="line">                            cont.add(second);</span><br><span class="line">                        &#125;</span><br><span class="line">                        Vector&lt;MatOfPoint&gt; polyedges = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">                        <span class="keyword">for</span>(MatOfPoint2f point : cont) &#123;</span><br><span class="line">                            MatOfPoint nPoint = <span class="keyword">new</span> MatOfPoint(point.toArray());</span><br><span class="line">                            polyedges.add(nPoint);</span><br><span class="line">                        &#125;</span><br><span class="line">                     Vector&lt;Point&gt; poly=<span class="keyword">new</span> Vector&lt;Point&gt;();</span><br><span class="line">                        MatOfPoint aPoint = polyedges.get(<span class="number">0</span>);</span><br><span class="line">                        Point[] ab=aPoint.toArray();</span><br><span class="line">                        <span class="comment">//Iterator&lt;Point&gt; itp = poly.listIterator(0);</span></span><br><span class="line">                        <span class="comment">//Point aa=poly.get(0);</span></span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;polyedges.size();j++) &#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; polyedges.get(j).toArray().length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                                line(dst, polyedges.get(j).toArray()[i], polyedges.get(j).toArray()[i + <span class="number">1</span>], <span class="keyword">new</span> Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">5</span>);</span><br><span class="line">                                <span class="comment">//aa=itp.next();</span></span><br><span class="line">                            &#125;</span><br><span class="line">                            line(dst,polyedges.get(j).toArray()[polyedges.get(j).toArray().length - <span class="number">1</span>],polyedges.get(j).toArray()[<span class="number">0</span>], <span class="keyword">new</span> Scalar(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>), <span class="number">5</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        <span class="comment">//Imgproc.threshold( mat_gray, dst, 100, 255, THRESH_BINARY );</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">/*RNG rng(12345);</span></span><br><span class="line"><span class="comment">                        Vector&lt;Vector&lt;Point&gt; &gt;hull=new Vector&lt;Vector&lt;Point&gt;&gt;( contours.size() );</span></span><br><span class="line"><span class="comment">                        for( int i = 0; i &lt; contours.size(); i++ )</span></span><br><span class="line"><span class="comment">                        &#123;  Imgproc.convexHull(new Mat((MatOfPoint2f)(contours.get(i))), hull.get(i), false ); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                        /// 绘出轮廓及其凸包</span></span><br><span class="line"><span class="comment">                        Mat drawing = Mat.zeros( dst.size(), CV_8UC3 );</span></span><br><span class="line"><span class="comment">                        for( int i = 0; i&lt; contours.size(); i++ )</span></span><br><span class="line"><span class="comment">                        &#123;</span></span><br><span class="line"><span class="comment">                            Scalar color = Scalar( rng.uniform(0, 255), rng.uniform(0,255), rng.uniform(0,255) );</span></span><br><span class="line"><span class="comment">                            Imgproc.drawContours( drawing, contours, i, color, 1, 8, Vector&lt;Vec4i&gt;(), 0, Point() );</span></span><br><span class="line"><span class="comment">                            drawContours( drawing, hull, i, color, 1, 8, vector&lt;Vec4i&gt;(), 0, Point() );</span></span><br><span class="line"><span class="comment">                        &#125;*/</span></span><br><span class="line"><span class="comment">//**********************************************************************</span></span><br><span class="line">                        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">double</span> area = <span class="number">0</span>, maxArea=<span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i &lt; polyedges.size(); i++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            area = Imgproc.contourArea(polyedges.get(i));</span><br><span class="line">                            <span class="keyword">if</span> (area &gt; maxArea)</span><br><span class="line">                            &#123;</span><br><span class="line">                                maxArea = area;</span><br><span class="line">                                index = i;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        MatOfPoint couPoint = polyedges.get(index);</span><br><span class="line">                        Point[] a=couPoint.toArray();</span><br><span class="line">                          <span class="comment">// List&lt;Point&gt; couPoint = contours.get(nContoursNum);</span></span><br><span class="line">                            Vector&lt;Point&gt; fingerTips = <span class="keyword">new</span> Vector&lt;Point&gt;();</span><br><span class="line">                            Point tmp = <span class="keyword">new</span> Point();</span><br><span class="line">                            <span class="keyword">double</span> max = <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">int</span> count = <span class="number">0</span>, notice = <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">                                tmp = a[i];</span><br><span class="line">                                <span class="keyword">double</span> dist = (tmp.x - center.x) * (tmp.x - center.x) + (tmp.y - center.y) * (tmp.y - center.y);</span><br><span class="line">                                <span class="keyword">if</span> (dist &gt; max) &#123;</span><br><span class="line">                                    max = dist;</span><br><span class="line">                                    notice = i;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="comment">// 计算最大值保持的点数，如果大于40（这个值需要设置，本来想根据max值来设置，</span></span><br><span class="line">                                <span class="comment">// 但是不成功，不知道为何），那么就认为这个是指尖</span></span><br><span class="line">                                <span class="keyword">if</span> (dist != max) &#123;</span><br><span class="line">                                        max = <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">                                        <span class="comment">// 低于手心的点不算</span></span><br><span class="line">                                        <span class="keyword">if</span> (center.y &lt; a[notice].y)</span><br><span class="line">                                            <span class="keyword">continue</span>;</span><br><span class="line">                                        <span class="comment">// 离得太近的不算</span></span><br><span class="line">                                        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; fingerTips.size(); j++) &#123;</span><br><span class="line">                                            <span class="keyword">if</span> (abs(a[notice].x - fingerTips.get(j).x) &lt; <span class="number">40</span>) &#123;</span><br><span class="line">                                                flag = <span class="keyword">true</span>;</span><br><span class="line">                                                <span class="keyword">break</span>;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="keyword">if</span> (flag) <span class="keyword">continue</span>;</span><br><span class="line">                                        fingerTips.add(a[notice]);</span><br><span class="line">                                        circle(dst, a[notice], <span class="number">6</span>, <span class="keyword">new</span> Scalar(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>), -<span class="number">1</span>);</span><br><span class="line">                                        line(dst, center, a[notice], <span class="keyword">new</span> Scalar(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>), <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                           textView.setText(String.valueOf(fingerTips.size()));</span><br><span class="line"><span class="comment">//*****************************************************</span></span><br><span class="line">                            Bitmap bmp_gray = Bitmap.createBitmap(mat_gray.cols(), mat_gray.rows(), Bitmap.Config.ARGB_8888);</span><br><span class="line">                            Utils.matToBitmap(dst, bmp_gray);</span><br><span class="line">                            picture.setImageBitmap(bmp_gray);</span><br><span class="line"></span><br><span class="line">                    &#125;<span class="keyword">catch</span> (FileNotFoundException e)&#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="四、程序效果："><a href="#四、程序效果：" class="headerlink" title="四、程序效果："></a>四、程序效果：</h3><p><img src="/2018/06/04/Android手指个数识别/图1.jpg" alt=""></p>
<p><img src="/2018/06/04/Android手指个数识别/图3.jpg" alt=""></p>
<p><img src="/2018/06/04/Android手指个数识别/图5.jpg" alt=""></p>
<h3 id="五、不足："><a href="#五、不足：" class="headerlink" title="五、不足："></a>五、不足：</h3><p>1.程序鲁棒性不足，容易收到背景环境的干扰，尤其是与肤色相近的环境。</p>
<p>2.处理速度慢，要等待数秒左右。</p>
<p>3.弯曲手指不彻底就会影响结果。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/04/Android手指个数识别/" data-id="cjl7x6cf30005qgumi2xdt5l1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-计算机图形学-opencv-Java/">Android 计算机图形学 opencv Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-吸烟者问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/28/吸烟者问题/" class="article-date">
  <time datetime="2018-05-28T08:47:33.000Z" itemprop="datePublished">2018-05-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/28/吸烟者问题/">吸烟者问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###一、问题描述</p>
<p>   抽烟者问题。假设一个系统中有三个抽烟者进程，每个抽烟者不断地卷烟并抽烟。抽烟者卷起并抽掉一颗烟需要有三种材料：烟草、纸和胶水。一个抽烟者有烟草，一个有纸，另一个有胶水。系统中还有两个供应者进程，它们无限地供应所有三种材料，但每次仅轮流提供三种材料中的两种。得到缺失的两种材料的抽烟者在卷起并抽掉一颗烟后会发信号通知供应者，让它继续提供另外的两种材料。这一过程重复进行。 请用以上介绍的 IPC 同步机制编程，实现该问题要求的功能。</p>
<h3 id="二、问题分析"><a href="#二、问题分析" class="headerlink" title="二、问题分析"></a>二、问题分析</h3><p>  这个问题主要涉及到操作系统中的进程见的同步与互斥的，是一个非常经典的问题。可以看做是生产者消费者这一类。</p>
<p>  三个抽烟者相当于三个不同的消费者，他们每次只会有一个抽烟者可以抽到烟，其余两个则需要等待。而在这里默认空间大小只有一个单元，即供应者每次放下两种材料后都会停下来等待直到有消费者使用了这两种材料，他才会继续放另两种材料。相当于说缓冲区的大小为1。为了方便起见，我们把要放的两种材料捆绑到一起，看成一个单位，分别用A、B、C表示，三个吸烟着分别用1,2,3号表示。</p>
<p>###三、画出大致的操作流程和关键代码</p>
<p><img src="/2018/05/28/吸烟者问题/图1.png" alt="img"> </p>
<p>设置五个信号量分别为三个抽烟者对应的glue、tobacco、paper和与供应者相应的同步信号量表示缓存区为空的empty信号量。最后还有一个保证临界资源安全访问的互斥信号量mutex。</p>
<p>供应者：                  1号抽烟者：               2号抽烟者：                  3号抽烟者:</p>
<p>while(1)                    while(1)                       while(1)                          whiel(1)</p>
<p>{                                 {                                   {                    {</p>
<p>p(empty);                  p(glue);                          p(tobacco);            p(paper);</p>
<p>p(mutex);                  p(mutex);                      p(mutex);            p(mutex);</p>
<p>供应材料。                抽烟                              抽烟                抽烟    </p>
<p>v(mutex)                    v(mutex);                      v(mutex);            v(mutex);</p>
<p>if（材料为A）           v(empty);                        v(empty);            v(empty);</p>
<p>v(glue)                        }                                }                        }</p>
<p>if(材料为B)</p>
<p>v(tobacco)</p>
<p>if(材料为C)</p>
<p>v(paper)</p>
<p>}    </p>
<p>信号量的初始值:</p>
<p>empty=1;mutex=1;glue=0;paper=0;tobacco=0;                          </p>
<h3 id="四、具体代码"><a href="#四、具体代码" class="headerlink" title="四、具体代码"></a>四、具体代码</h3><p>ipc.h:</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Filename</span></span><br><span class="line"><span class="comment">: ipc.h</span></span><br><span class="line"><span class="comment">* copyright</span></span><br><span class="line"><span class="comment">: (C) 2006 by zhonghonglie</span></span><br><span class="line"><span class="comment">* Function</span></span><br><span class="line"><span class="comment">: 澹版槑 IPC 鏈哄埗鐨勫嚱鏁板師鍨嬪拰鍏ㄥ眬鍙橀噺</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ipc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/shm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/sem.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/msg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFSZ 256</span></span><br><span class="line"><span class="comment">//寤虹珛鎴栬幏鍙?ipc 鐨勪竴缁勫嚱鏁扮殑鍘熷瀷璇存槑</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_ipc_id</span><span class="params">(<span class="keyword">char</span> *proc_file,<span class="keyword">key_t</span> key)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">set_shm</span><span class="params">(<span class="keyword">key_t</span> shm_key,<span class="keyword">int</span> shm_num,<span class="keyword">int</span> shm_flag)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">set_msq</span><span class="params">(<span class="keyword">key_t</span> msq_key,<span class="keyword">int</span> msq_flag)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">set_sem</span><span class="params">(<span class="keyword">key_t</span> sem_key,<span class="keyword">int</span> sem_val,<span class="keyword">int</span> sem_flag)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> sem_id)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> sem_id)</span></span>;</span><br><span class="line"><span class="comment">/*淇″彿鐏帶鍒剁敤鐨勫叡鍚屼綋*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> semuns &#123;</span><br><span class="line"><span class="keyword">int</span> val;</span><br><span class="line">&#125; Sem_uns;</span><br><span class="line"><span class="comment">/* 娑堟伅缁撴瀯浣?/</span></span><br><span class="line"><span class="comment">typedef struct msgbuf &#123;</span></span><br><span class="line"><span class="comment">long mtype;</span></span><br><span class="line"><span class="comment">char mtext[1];</span></span><br><span class="line"><span class="comment">&#125; Msg_buf;</span></span><br><span class="line"><span class="comment">//鐢熶骇娑堣垂鑰呭叡浜紦鍐插尯鍗冲叾鏈夊叧鐨勫彉閲?</span></span><br><span class="line"><span class="comment">key_t buff_key;</span></span><br><span class="line"><span class="comment">int buff_num;</span></span><br><span class="line"><span class="comment">char *buff_ptr;</span></span><br><span class="line"><span class="comment">//鐢熶骇鑰呮斁浜у搧浣嶇疆鐨勫叡浜寚閽?</span></span><br><span class="line"><span class="comment">key_t pput_key;</span></span><br><span class="line"><span class="comment">int pput_num;</span></span><br><span class="line"><span class="comment">int *pput_ptr;</span></span><br><span class="line"><span class="comment">//娑堣垂鑰呭彇浜у搧浣嶇疆鐨勫叡浜寚閽?</span></span><br><span class="line"><span class="comment">key_t cget_key;</span></span><br><span class="line"><span class="comment">int cget_num;</span></span><br><span class="line"><span class="comment">int *cget_ptr;</span></span><br><span class="line"><span class="comment">//鐢熶骇鑰呮湁鍏崇殑淇″彿閲?</span></span><br><span class="line"><span class="comment">key_t tobacco_key;</span></span><br><span class="line"><span class="comment">key_t glue_key;</span></span><br><span class="line"><span class="comment">key_t paper_key;</span></span><br><span class="line"><span class="comment">int tobacco_sem;</span></span><br><span class="line"><span class="comment">int glue_sem;</span></span><br><span class="line"><span class="comment">int paper_sem;</span></span><br><span class="line"><span class="comment">//娑堣垂鑰呮湁鍏崇殑淇″彿閲?</span></span><br><span class="line"><span class="comment">key_t empty_key;</span></span><br><span class="line"><span class="comment">key_t mutex_key;</span></span><br><span class="line"><span class="comment">int empty_sem;</span></span><br><span class="line"><span class="comment">int mutex_sem;</span></span><br><span class="line"><span class="comment">int sem_val;</span></span><br><span class="line"><span class="comment">int sem_flg;</span></span><br><span class="line"><span class="comment">int shm_flg;</span></span><br></pre></td></tr></table></figure>
<p>ipc.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">绗?41 椤靛疄楠屽洓銆佽繘绋嬪悓姝ュ疄楠?</span></span><br><span class="line"><span class="comment">* Filename</span></span><br><span class="line"><span class="comment">* copyright</span></span><br><span class="line"><span class="comment">* Function</span></span><br><span class="line"><span class="comment">: ipc.c</span></span><br><span class="line"><span class="comment">: (C) 2006 by zhonghonglie</span></span><br><span class="line"><span class="comment">: 涓€缁勫缓绔?IPC 鏈哄埗鐨勫嚱鏁?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ipc.h"</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* get_ipc_id() 浠?proc/sysvipc/鏂囦欢绯荤粺涓幏鍙?IPC 鐨?id 鍙?</span></span><br><span class="line"><span class="comment">* pfile: 瀵瑰簲/proc/sysvipc/鐩綍涓殑 IPC 鏂囦欢鍒嗗埆涓?</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">msg-娑堟伅闃熷垪,sem-淇″彿閲?shm-鍏变韩鍐呭瓨</span></span><br><span class="line"><span class="comment">* key: 瀵瑰簲瑕佽幏鍙栫殑 IPC 鐨?id 鍙风殑閿€?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_ipc_id</span><span class="params">(<span class="keyword">char</span> *proc_file,<span class="keyword">key_t</span> key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">FILE *pf;</span><br><span class="line"><span class="keyword">int</span> i,j;</span><br><span class="line"><span class="keyword">char</span> line[BUFSZ],colum[BUFSZ];</span><br><span class="line"><span class="keyword">if</span>((pf = fopen(proc_file,<span class="string">"r"</span>)) == <span class="literal">NULL</span>)&#123;</span><br><span class="line">perror(<span class="string">"Proc file not open"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line">fgets(line, BUFSZ,pf);</span><br><span class="line"><span class="keyword">while</span>(!feof(pf))&#123;</span><br><span class="line">i = j = <span class="number">0</span>;</span><br><span class="line">fgets(line, BUFSZ,pf);</span><br><span class="line"><span class="keyword">while</span>(line[i] == <span class="string">' '</span>) i++;</span><br><span class="line"><span class="keyword">while</span>(line[i] !=<span class="string">' '</span>) colum[j++] = line[i++];</span><br><span class="line">colum[j] = <span class="string">'\0'</span>;</span><br><span class="line"><span class="keyword">if</span>(atoi(colum) != key) <span class="keyword">continue</span>;</span><br><span class="line">j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(line[i] == <span class="string">' '</span>) i++;</span><br><span class="line"><span class="keyword">while</span>(line[i] !=<span class="string">' '</span>) colum[j++] = line[i++];</span><br><span class="line">colum[j] = <span class="string">'\0'</span>;</span><br><span class="line">i = atoi(colum);</span><br><span class="line">fclose(pf);</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line">fclose(pf);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 淇″彿鐏笂鐨?down/up 鎿嶄綔</span></span><br><span class="line"><span class="comment">* semid:淇″彿鐏暟缁勬爣璇嗙</span></span><br><span class="line"><span class="comment">* semnum:淇″彿鐏暟缁勪笅鏍?</span></span><br><span class="line"><span class="comment">* buf:鎿嶄綔淇″彿鐏殑缁撴瀯</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">down</span><span class="params">(<span class="keyword">int</span> sem_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">buf</span>;</span></span><br><span class="line">buf.sem_op = <span class="number">-1</span>;</span><br><span class="line">buf.sem_num = <span class="number">0</span>;</span><br><span class="line">buf.sem_flg = SEM_UNDO;</span><br><span class="line"><span class="keyword">if</span>((semop(sem_id,&amp;buf,<span class="number">1</span>)) &lt;<span class="number">0</span>) &#123;</span><br><span class="line">perror(<span class="string">"down error "</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> sem_id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sembuf</span> <span class="title">buf</span>;</span></span><br><span class="line">buf.sem_op = <span class="number">1</span>;</span><br><span class="line">buf.sem_num = <span class="number">0</span>;</span><br><span class="line">buf.sem_flg = SEM_UNDO;</span><br><span class="line"><span class="keyword">if</span>((semop(sem_id,&amp;buf,<span class="number">1</span>)) &lt;<span class="number">0</span>) &#123;</span><br><span class="line">perror(<span class="string">"up error "</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* set_sem 鍑芥暟寤虹珛涓€涓叿鏈?n 涓俊鍙风伅鐨勪俊鍙烽噺</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">濡傛灉寤虹珛鎴愬姛,杩斿洖 涓€涓俊鍙风伅鏁扮粍鐨勬爣璇嗙 sem_id</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">杈撳叆鍙傛暟:</span></span><br><span class="line"><span class="comment">* sem_key 淇″彿鐏暟缁勭殑閿€?</span></span><br><span class="line"><span class="comment">* sem_val 淇″彿鐏暟缁勪腑淇″彿鐏殑涓暟</span></span><br><span class="line"><span class="comment">* sem_flag 淇″彿绛夋暟缁勭殑瀛樺彇鏉冮檺</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">set_sem</span><span class="params">(<span class="keyword">key_t</span> sem_key,<span class="keyword">int</span> sem_val,<span class="keyword">int</span> sem_flg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> sem_id;</span><br><span class="line">Sem_uns sem_arg;</span><br><span class="line"><span class="comment">//娴嬭瘯鐢?sem_key 鏍囪瘑鐨勪俊鍙风伅鏁扮粍鏄惁宸茬粡寤虹珛</span></span><br><span class="line"><span class="keyword">if</span>((sem_id = get_ipc_id(<span class="string">"/proc/sysvipc/sem"</span>,sem_key)) &lt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//semget 鏂板缓涓€涓俊鍙风伅,鍏舵爣鍙疯繑鍥炲埌 sem_id</span></span><br><span class="line"><span class="keyword">if</span>((sem_id = semget(sem_key,<span class="number">1</span>,sem_flg)) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"semaphore create error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//璁剧疆淇″彿鐏殑鍒濆€?</span></span><br><span class="line">sem_arg.val = sem_val;</span><br><span class="line"><span class="keyword">if</span>(semctl(sem_id,<span class="number">0</span>,SETVAL,sem_arg) &lt;<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"semaphore set error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sem_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* set_shm 鍑芥暟寤虹珛涓€涓叿鏈?n 涓瓧鑺?鐨勫叡浜唴瀛樺尯</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">濡傛灉寤虹珛鎴愬姛,杩斿洖 涓€涓寚鍚戣鍐呭瓨鍖洪鍦板潃鐨勬寚閽?shm_buf</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">杈撳叆鍙傛暟:</span></span><br><span class="line"><span class="comment">* shm_key 鍏变韩鍐呭瓨鐨勯敭鍊?</span></span><br><span class="line"><span class="comment">* shm_val 鍏变韩鍐呭瓨瀛楄妭鐨勯暱搴?</span></span><br><span class="line"><span class="comment">* shm_flag 鍏变韩鍐呭瓨鐨勫瓨鍙栨潈闄?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> * <span class="title">set_shm</span><span class="params">(<span class="keyword">key_t</span> shm_key,<span class="keyword">int</span> shm_num,<span class="keyword">int</span> shm_flg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i,shm_id;</span><br><span class="line"><span class="keyword">char</span> * shm_buf;</span><br><span class="line"><span class="comment">//娴嬭瘯鐢?shm_key 鏍囪瘑鐨勫叡浜唴瀛樺尯鏄惁宸茬粡寤虹珛</span></span><br><span class="line"><span class="keyword">if</span>((shm_id = get_ipc_id(<span class="string">"/proc/sysvipc/shm"</span>,shm_key)) &lt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//shmget 鏂板缓 涓€涓暱搴︿负 shm_num 瀛楄妭鐨勫叡浜唴瀛?鍏舵爣鍙疯繑鍥炲埌 shm_id</span></span><br><span class="line"><span class="keyword">if</span>((shm_id = shmget(shm_key,shm_num,shm_flg)) &lt;<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"shareMemory set error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//shmat 灏嗙敱 shm_id 鏍囪瘑鐨勫叡浜唴瀛橀檮鍔犵粰鎸囬拡 shm_buf</span></span><br><span class="line"><span class="keyword">if</span>((shm_buf = (<span class="keyword">char</span> *)shmat(shm_id,<span class="number">0</span>,<span class="number">0</span>)) &lt; (<span class="keyword">char</span> *)<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"get shareMemory error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;shm_num; i++) shm_buf[i] = <span class="number">0</span>; <span class="comment">//鍒濆涓?0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//shm_key 鏍囪瘑鐨勫叡浜唴瀛樺尯宸茬粡寤虹珛,灏嗙敱 shm_id 鏍囪瘑鐨勫叡浜唴瀛橀檮鍔犵粰鎸囬拡 shm_buf</span></span><br><span class="line"><span class="keyword">if</span>((shm_buf = (<span class="keyword">char</span> *)shmat(shm_id,<span class="number">0</span>,<span class="number">0</span>)) &lt; (<span class="keyword">char</span> *)<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"get shareMemory error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> shm_buf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* set_msq 鍑芥暟寤虹珛涓€涓秷鎭槦鍒?</span></span><br><span class="line"><span class="comment">* 濡傛灉寤虹珛鎴愬姛,杩斿洖 涓€涓秷鎭槦鍒楃殑鏍囪瘑绗?msq_id</span></span><br><span class="line"><span class="comment">* 杈撳叆鍙傛暟:</span></span><br><span class="line"><span class="comment">* msq_key 娑堟伅闃熷垪鐨勯敭鍊?</span></span><br><span class="line"><span class="comment">* msq_flag 娑堟伅闃熷垪鐨勫瓨鍙栨潈闄?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">set_msq</span><span class="params">(<span class="keyword">key_t</span> msq_key,<span class="keyword">int</span> msq_flg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> msq_id;</span><br><span class="line"><span class="comment">//娴嬭瘯鐢?msq_key 鏍囪瘑鐨勬秷鎭槦鍒楁槸鍚﹀凡缁忓缓绔?</span></span><br><span class="line"><span class="keyword">if</span>((msq_id = get_ipc_id(<span class="string">"/proc/sysvipc/msg"</span>,msq_key)) &lt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//msgget 鏂板缓涓€涓秷鎭槦鍒?鍏舵爣鍙疯繑鍥炲埌 msq_id</span></span><br><span class="line"><span class="keyword">if</span>((msq_id = msgget(msq_key,msq_flg)) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"messageQueue set error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> msq_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>供应者：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Filename</span></span><br><span class="line"><span class="comment">: producer.c</span></span><br><span class="line"><span class="comment">* copyright</span></span><br><span class="line"><span class="comment">: (C) 2006 by zhonghonglie</span></span><br><span class="line"><span class="comment">* Function</span></span><br><span class="line"><span class="comment">: 寤虹珛骞舵ā鎷熺敓浜ц€呰繘绋?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ipc.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> rate;</span><br><span class="line"><span class="comment">//鍙湪鍦ㄥ懡浠よ绗竴鍙傛暟鎸囧畾涓€涓繘绋嬬潯鐪犵鏁?浠ヨ皟瑙ｈ繘绋嬫墽琛岄€熷害</span></span><br><span class="line"><span class="keyword">if</span>(argv[<span class="number">1</span>] != <span class="literal">NULL</span>) rate = atoi(argv[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">else</span> rate = <span class="number">3</span>; <span class="comment">//涓嶆寚瀹氫负 3 绉?</span></span><br><span class="line"><span class="comment">//鍏变韩鍐呭瓨浣跨敤鐨勫彉閲?</span></span><br><span class="line">buff_key = <span class="number">101</span>;<span class="comment">//缂撳啿鍖轰换缁欑殑閿€?</span></span><br><span class="line">buff_num = <span class="number">1</span>;<span class="comment">//缂撳啿鍖轰换缁欑殑闀垮害</span></span><br><span class="line">pput_key = <span class="number">102</span>;<span class="comment">//鐢熶骇鑰呮斁浜у搧鎸囬拡鐨勯敭鍊?</span></span><br><span class="line">pput_num = <span class="number">1</span>; <span class="comment">//鎸囬拡鏁?</span></span><br><span class="line">shm_flg = IPC_CREAT | <span class="number">0644</span>;<span class="comment">//鍏变韩鍐呭瓨璇诲啓鏉冮檺</span></span><br><span class="line"><span class="comment">//鑾峰彇缂撳啿鍖轰娇鐢ㄧ殑鍏变韩鍐呭瓨,buff_ptr 鎸囧悜缂撳啿鍖洪鍦板潃</span></span><br><span class="line">buff_ptr = (<span class="keyword">char</span> *)set_shm(buff_key,buff_num,shm_flg);</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呮斁浜у搧浣嶇疆鎸囬拡 pput_ptr</span></span><br><span class="line">pput_ptr = (<span class="keyword">int</span> *)set_shm(pput_key,pput_num,shm_flg);</span><br><span class="line"><span class="comment">//淇″彿閲忎娇鐢ㄧ殑鍙橀噺</span></span><br><span class="line">tobacco_key = <span class="number">201</span>; <span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">glue_key = <span class="number">202</span>; <span class="comment">//鐢熶骇鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">paper_key=<span class="number">203</span>;  <span class="comment">//鐢熶骇鑰?鐨勫悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">empty_key = <span class="number">301</span>; <span class="comment">//娑堣垂鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">mutex_key = <span class="number">302</span>; <span class="comment">//娑堣垂鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">sem_flg = IPC_CREAT | <span class="number">0644</span>;</span><br><span class="line"><span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅鍒濆€艰涓虹紦鍐插尯鏈€澶у彲鐢ㄩ噺</span></span><br><span class="line">sem_val = buff_num;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?prod_sem</span></span><br><span class="line">empty_sem = set_sem(empty_key,sem_val,sem_flg);</span><br><span class="line"><span class="comment">//娑堣垂鑰呭垵濮嬫棤浜у搧鍙彇,鍚屾淇″彿鐏垵鍊艰涓?0</span></span><br><span class="line">sem_val = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?cons_sem</span></span><br><span class="line">paper_sem = set_sem(paper_key,sem_val,sem_flg);</span><br><span class="line">glue_sem = set_sem(glue_key,sem_val,sem_flg);</span><br><span class="line">tobacco_sem = set_sem(tobacco_key,sem_val,sem_flg);</span><br><span class="line"><span class="comment">//鐢熶骇鑰呬簰鏂ヤ俊鍙风伅鍒濆€间负 1</span></span><br><span class="line">sem_val = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呬簰鏂ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?pmtx_sem</span></span><br><span class="line"> mutex_sem = set_sem(mutex_key,sem_val,sem_flg);</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="comment">//寰幆鎵ц妯℃嫙鐢熶骇鑰呬笉鏂斁浜у搧</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">int</span> d;</span><br><span class="line"><span class="comment">//濡傛灉缂撳啿鍖烘弧鍒欑敓浜ц€呴樆濉?</span></span><br><span class="line">down(empty_sem);</span><br><span class="line"><span class="comment">//濡傛灉鍙︿竴鐢熶骇鑰呮鍦ㄦ斁浜у搧,鏈敓浜ц€呴樆濉?</span></span><br><span class="line">down(mutex_sem);</span><br><span class="line"><span class="comment">//鐢ㄥ啓涓€瀛楃鐨勫舰寮忔ā鎷熺敓浜ц€呮斁浜у搧,鎶ュ憡鏈繘绋嬪彿鍜屾斁鍏ョ殑瀛楃鍙婂瓨鏀剧殑浣嶇疆</span></span><br><span class="line">sleep(rate);</span><br><span class="line">d=(i++)%<span class="number">3</span>;</span><br><span class="line">buff_ptr[*pput_ptr] = <span class="string">'A'</span>+ d;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d provider put: %c to Buffer[%d]\n"</span>,getpid(),buff_ptr[*pput_ptr],*pput_ptr);</span><br><span class="line"><span class="comment">//瀛樻斁浣嶇疆寰幆涓嬬Щ</span></span><br><span class="line">*pput_ptr = (*pput_ptr+<span class="number">1</span>) % buff_num;</span><br><span class="line"><span class="comment">//鍞ら啋闃诲鐨勭敓浜ц€?</span></span><br><span class="line">up(mutex_sem);</span><br><span class="line"><span class="comment">//鍞ら啋闃诲鐨勬秷璐硅€?</span></span><br><span class="line"><span class="keyword">if</span>(d==<span class="number">0</span>)</span><br><span class="line">up(paper_sem);</span><br><span class="line"><span class="keyword">if</span>(d==<span class="number">1</span>)</span><br><span class="line">up(glue_sem);</span><br><span class="line"><span class="keyword">if</span>(d==<span class="number">2</span>)</span><br><span class="line">up(tobacco_sem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>三个抽烟者:</p>
<p>glue.c:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Filename</span></span><br><span class="line"><span class="comment">: consumer.c</span></span><br><span class="line"><span class="comment">copyright</span></span><br><span class="line"><span class="comment">: (C) by zhanghonglie</span></span><br><span class="line"><span class="comment">Function</span></span><br><span class="line"><span class="comment">: 寤虹珛骞舵ā鎷熸秷璐硅€呰繘绋?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ipc.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> rate;</span><br><span class="line"><span class="comment">//鍙湪鍦ㄥ懡浠よ绗竴鍙傛暟鎸囧畾涓€涓繘绋嬬潯鐪犵鏁?浠ヨ皟瑙ｈ繘绋嬫墽琛岄€熷害</span></span><br><span class="line"><span class="keyword">if</span>(argv[<span class="number">1</span>] != <span class="literal">NULL</span>) rate = atoi(argv[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">else</span> rate = <span class="number">3</span>; <span class="comment">//涓嶆寚瀹氫负 3 绉?</span></span><br><span class="line"><span class="comment">//鍏变韩鍐呭瓨 浣跨敤鐨勫彉閲?</span></span><br><span class="line">buff_key = <span class="number">101</span>; <span class="comment">//缂撳啿鍖轰换缁欑殑閿€?</span></span><br><span class="line">buff_num = <span class="number">1</span>; <span class="comment">//缂撳啿鍖轰换缁欑殑闀垮害</span></span><br><span class="line">cget_key = <span class="number">103</span>; <span class="comment">//娑堣垂鑰呭彇浜у搧鎸囬拡鐨勯敭鍊?</span></span><br><span class="line">cget_num = <span class="number">1</span>; <span class="comment">//鎸囬拡鏁?</span></span><br><span class="line">shm_flg = IPC_CREAT | <span class="number">0644</span>; <span class="comment">//鍏变韩鍐呭瓨璇诲啓鏉冮檺</span></span><br><span class="line"><span class="comment">//鑾峰彇缂撳啿鍖轰娇鐢ㄧ殑鍏变韩鍐呭瓨,buff_ptr 鎸囧悜缂撳啿鍖洪鍦板潃</span></span><br><span class="line">buff_ptr = (<span class="keyword">char</span> *)set_shm(buff_key,buff_num,shm_flg);</span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭彇浜у搧鎸囬拡,cget_ptr 鎸囧悜绱㈠紩鍦板潃</span></span><br><span class="line">cget_ptr = (<span class="keyword">int</span> *)set_shm(cget_key,cget_num,shm_flg);</span><br><span class="line"><span class="comment">//淇″彿閲忎娇鐢ㄧ殑鍙橀噺</span></span><br><span class="line">tobacco_key = <span class="number">201</span>; <span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">glue_key = <span class="number">202</span>; <span class="comment">//鐢熶骇鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">paper_key=<span class="number">203</span>;  <span class="comment">//鐢熶骇鑰?鐨勫悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">empty_key = <span class="number">301</span>; <span class="comment">//娑堣垂鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">mutex_key = <span class="number">302</span>; <span class="comment">//娑堣垂鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">sem_flg = IPC_CREAT | <span class="number">0644</span>; <span class="comment">//淇″彿鐏搷浣滄潈闄?</span></span><br><span class="line"><span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅鍒濆€艰涓虹紦鍐插尯鏈€澶у彲鐢ㄩ噺</span></span><br><span class="line">sem_val = buff_num;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?prod_sem</span></span><br><span class="line">empty_sem = set_sem(empty_key,sem_val,sem_flg);</span><br><span class="line"><span class="comment">//娑堣垂鑰呭垵濮嬫棤浜у搧鍙彇,鍚屾淇″彿鐏垵鍊艰涓?0</span></span><br><span class="line">sem_val = <span class="number">0</span>; </span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?cons_sem</span></span><br><span class="line">glue_sem = set_sem(glue_key,sem_val,sem_flg);</span><br><span class="line">sem_val = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呬簰鏂ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?pmtx_sem</span></span><br><span class="line"> mutex_sem = set_sem(mutex_key,sem_val,sem_flg);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">//濡傛灉鏃犱骇鍝佹秷璐硅€呴樆濉?</span></span><br><span class="line">down(glue_sem);</span><br><span class="line">down(mutex_sem);</span><br><span class="line"><span class="comment">//鐢ㄨ涓€瀛楃鐨勫舰寮忔ā鎷熸秷璐硅€呭彇浜у搧,鎶ュ憡鏈繘绋嬪彿鍜?</span></span><br><span class="line">sleep(rate);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d  1鍙峰惛鐑熻€?寰楀埌浜? %c鐑熻崏鍜岀焊 from Buffer[%d]\n"</span>,getpid(),buff_ptr[*cget_ptr],*cget_ptr);</span><br><span class="line"><span class="comment">//璇诲彇浣嶇疆寰幆涓嬬Щ</span></span><br><span class="line">*cget_ptr = (*cget_ptr+<span class="number">1</span>) % buff_num;</span><br><span class="line">up(mutex_sem);</span><br><span class="line"><span class="comment">//鍞ら啋闃诲鐨勭敓浜ц€?</span></span><br><span class="line">up(empty_sem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tobacco.c:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Filename</span></span><br><span class="line"><span class="comment">: consumer.c</span></span><br><span class="line"><span class="comment">copyright</span></span><br><span class="line"><span class="comment">: (C) by zhanghonglie</span></span><br><span class="line"><span class="comment">Function</span></span><br><span class="line"><span class="comment">: 寤虹珛骞舵ā鎷熸秷璐硅€呰繘绋?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ipc.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> rate;</span><br><span class="line"><span class="comment">//鍙湪鍦ㄥ懡浠よ绗竴鍙傛暟鎸囧畾涓€涓繘绋嬬潯鐪犵鏁?浠ヨ皟瑙ｈ繘绋嬫墽琛岄€熷害</span></span><br><span class="line"><span class="keyword">if</span>(argv[<span class="number">1</span>] != <span class="literal">NULL</span>) rate = atoi(argv[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">else</span> rate = <span class="number">3</span>; <span class="comment">//涓嶆寚瀹氫负 3 绉?</span></span><br><span class="line"><span class="comment">//鍏变韩鍐呭瓨 浣跨敤鐨勫彉閲?</span></span><br><span class="line">buff_key = <span class="number">101</span>; <span class="comment">//缂撳啿鍖轰换缁欑殑閿€?</span></span><br><span class="line">buff_num = <span class="number">1</span>; <span class="comment">//缂撳啿鍖轰换缁欑殑闀垮害</span></span><br><span class="line">cget_key = <span class="number">103</span>; <span class="comment">//娑堣垂鑰呭彇浜у搧鎸囬拡鐨勯敭鍊?</span></span><br><span class="line">cget_num = <span class="number">1</span>; <span class="comment">//鎸囬拡鏁?</span></span><br><span class="line">shm_flg = IPC_CREAT | <span class="number">0644</span>; <span class="comment">//鍏变韩鍐呭瓨璇诲啓鏉冮檺</span></span><br><span class="line"><span class="comment">//鑾峰彇缂撳啿鍖轰娇鐢ㄧ殑鍏变韩鍐呭瓨,buff_ptr 鎸囧悜缂撳啿鍖洪鍦板潃</span></span><br><span class="line">buff_ptr = (<span class="keyword">char</span> *)set_shm(buff_key,buff_num,shm_flg);</span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭彇浜у搧鎸囬拡,cget_ptr 鎸囧悜绱㈠紩鍦板潃</span></span><br><span class="line">cget_ptr = (<span class="keyword">int</span> *)set_shm(cget_key,cget_num,shm_flg);</span><br><span class="line"><span class="comment">//淇″彿閲忎娇鐢ㄧ殑鍙橀噺</span></span><br><span class="line">tobacco_key = <span class="number">201</span>; <span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">glue_key = <span class="number">202</span>; <span class="comment">//鐢熶骇鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">paper_key=<span class="number">203</span>;  <span class="comment">//鐢熶骇鑰?鐨勫悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">empty_key = <span class="number">301</span>; <span class="comment">//娑堣垂鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">mutex_key = <span class="number">302</span>; <span class="comment">//娑堣垂鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">sem_flg = IPC_CREAT | <span class="number">0644</span>; <span class="comment">//淇″彿鐏搷浣滄潈闄?</span></span><br><span class="line"><span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅鍒濆€艰涓虹紦鍐插尯鏈€澶у彲鐢ㄩ噺</span></span><br><span class="line">sem_val = buff_num;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?prod_sem</span></span><br><span class="line">empty_sem = set_sem(empty_key,sem_val,sem_flg);</span><br><span class="line"><span class="comment">//娑堣垂鑰呭垵濮嬫棤浜у搧鍙彇,鍚屾淇″彿鐏垵鍊艰涓?0</span></span><br><span class="line">sem_val = <span class="number">0</span>; </span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?cons_sem</span></span><br><span class="line">tobacco_sem = set_sem(tobacco_key,sem_val,sem_flg);</span><br><span class="line">sem_val = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呬簰鏂ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?pmtx_sem</span></span><br><span class="line"> mutex_sem = set_sem(mutex_key,sem_val,sem_flg);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">//濡傛灉鏃犱骇鍝佹秷璐硅€呴樆濉?</span></span><br><span class="line">down(tobacco_sem);</span><br><span class="line">down(mutex_sem);</span><br><span class="line"><span class="comment">//鐢ㄨ涓€瀛楃鐨勫舰寮忔ā鎷熸秷璐硅€呭彇浜у搧,鎶ュ憡鏈繘绋嬪彿鍜?</span></span><br><span class="line">sleep(rate);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d  2鍙峰惛鐑熻€?寰楀埌浜? %c鑳舵按鍜岀焊 from Buffer[%d]\n"</span>,getpid(),buff_ptr[*cget_ptr],*cget_ptr);</span><br><span class="line"><span class="comment">//璇诲彇浣嶇疆寰幆涓嬬Щ</span></span><br><span class="line">*cget_ptr = (*cget_ptr+<span class="number">1</span>) % buff_num;</span><br><span class="line"><span class="comment">//鍞ら啋闃诲鐨勭敓浜ц€?</span></span><br><span class="line">up(mutex_sem);</span><br><span class="line">up(empty_sem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>paper.c:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Filename</span></span><br><span class="line"><span class="comment">: consumer.c</span></span><br><span class="line"><span class="comment">copyright</span></span><br><span class="line"><span class="comment">: (C) by zhanghonglie</span></span><br><span class="line"><span class="comment">Function</span></span><br><span class="line"><span class="comment">: 寤虹珛骞舵ā鎷熸秷璐硅€呰繘绋?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ipc.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> rate;</span><br><span class="line"><span class="comment">//鍙湪鍦ㄥ懡浠よ绗竴鍙傛暟鎸囧畾涓€涓繘绋嬬潯鐪犵鏁?浠ヨ皟瑙ｈ繘绋嬫墽琛岄€熷害</span></span><br><span class="line"><span class="keyword">if</span>(argv[<span class="number">1</span>] != <span class="literal">NULL</span>) rate = atoi(argv[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">else</span> rate = <span class="number">3</span>; <span class="comment">//涓嶆寚瀹氫负 3 绉?</span></span><br><span class="line"><span class="comment">//鍏变韩鍐呭瓨 浣跨敤鐨勫彉閲?</span></span><br><span class="line">buff_key = <span class="number">101</span>; <span class="comment">//缂撳啿鍖轰换缁欑殑閿€?</span></span><br><span class="line">buff_num = <span class="number">1</span>; <span class="comment">//缂撳啿鍖轰换缁欑殑闀垮害</span></span><br><span class="line">cget_key = <span class="number">103</span>; <span class="comment">//娑堣垂鑰呭彇浜у搧鎸囬拡鐨勯敭鍊?</span></span><br><span class="line">cget_num = <span class="number">1</span>; <span class="comment">//鎸囬拡鏁?</span></span><br><span class="line">shm_flg = IPC_CREAT | <span class="number">0644</span>; <span class="comment">//鍏变韩鍐呭瓨璇诲啓鏉冮檺</span></span><br><span class="line"><span class="comment">//鑾峰彇缂撳啿鍖轰娇鐢ㄧ殑鍏变韩鍐呭瓨,buff_ptr 鎸囧悜缂撳啿鍖洪鍦板潃</span></span><br><span class="line">buff_ptr = (<span class="keyword">char</span> *)set_shm(buff_key,buff_num,shm_flg);</span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭彇浜у搧鎸囬拡,cget_ptr 鎸囧悜绱㈠紩鍦板潃</span></span><br><span class="line">cget_ptr = (<span class="keyword">int</span> *)set_shm(cget_key,cget_num,shm_flg);</span><br><span class="line"><span class="comment">//淇″彿閲忎娇鐢ㄧ殑鍙橀噺</span></span><br><span class="line">tobacco_key = <span class="number">201</span>; <span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">glue_key = <span class="number">202</span>; <span class="comment">//鐢熶骇鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">paper_key=<span class="number">203</span>;  <span class="comment">//鐢熶骇鑰?鐨勫悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">empty_key = <span class="number">301</span>; <span class="comment">//娑堣垂鑰呭悓姝ヤ俊鍙风伅閿€?</span></span><br><span class="line">mutex_key = <span class="number">302</span>; <span class="comment">//娑堣垂鑰呬簰鏂ヤ俊鍙风伅閿€?</span></span><br><span class="line">sem_flg = IPC_CREAT | <span class="number">0644</span>; <span class="comment">//淇″彿鐏搷浣滄潈闄?</span></span><br><span class="line"><span class="comment">//鐢熶骇鑰呭悓姝ヤ俊鍙风伅鍒濆€艰涓虹紦鍐插尯鏈€澶у彲鐢ㄩ噺</span></span><br><span class="line">sem_val = buff_num;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?prod_sem</span></span><br><span class="line">empty_sem = set_sem(empty_key,sem_val,sem_flg);</span><br><span class="line"><span class="comment">//娑堣垂鑰呭垵濮嬫棤浜у搧鍙彇,鍚屾淇″彿鐏垵鍊艰涓?0</span></span><br><span class="line">sem_val = <span class="number">0</span>; </span><br><span class="line"><span class="comment">//鑾峰彇娑堣垂鑰呭悓姝ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?cons_sem</span></span><br><span class="line">paper_sem = set_sem(paper_key,sem_val,sem_flg);</span><br><span class="line">sem_val = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//鑾峰彇鐢熶骇鑰呬簰鏂ヤ俊鍙风伅,寮曠敤鏍囪瘑瀛?pmtx_sem</span></span><br><span class="line"> mutex_sem = set_sem(mutex_key,sem_val,sem_flg);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">//濡傛灉鏃犱骇鍝佹秷璐硅€呴樆濉?</span></span><br><span class="line">down(paper_sem);</span><br><span class="line"><span class="comment">//鐢ㄨ涓€瀛楃鐨勫舰寮忔ā鎷熸秷璐硅€呭彇浜у搧,鎶ュ憡鏈繘绋嬪彿鍜?</span></span><br><span class="line">down(mutex_sem);</span><br><span class="line">sleep(rate);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d  0鍙峰惛鐑熻€?寰楀埌浜? %c鐑熻崏鍜岃兌姘?from Buffer[%d]\n"</span>,getpid(),buff_ptr[*cget_ptr],*cget_ptr);</span><br><span class="line"><span class="comment">//璇诲彇浣嶇疆寰幆涓嬬Щ</span></span><br><span class="line">*cget_ptr = (*cget_ptr+<span class="number">1</span>) % buff_num;</span><br><span class="line">up(mutex_sem);</span><br><span class="line"><span class="comment">//鍞ら啋闃诲鐨勭敓浜ц€?</span></span><br><span class="line">up(empty_sem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>makefile:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">hdrs = ipc.h</span><br><span class="line">opts = -g -c</span><br><span class="line">c_src = glue.c ipc.c</span><br><span class="line">c_obj = glue.o ipc.o</span><br><span class="line">d_src = paper.c ipc.c</span><br><span class="line">d_obj = paper.o ipc.o</span><br><span class="line">e_src = tobacco.c ipc.c</span><br><span class="line">e_obj = tobacco.o ipc.o</span><br><span class="line">f_src = provider.c ipc.c</span><br><span class="line">f_obj = provider.o ipc.o</span><br><span class="line"><span class="section">all:	glue paper tobacco provider</span></span><br><span class="line"><span class="section">glue:	<span class="variable">$(c_obj)</span></span></span><br><span class="line">	gcc <span class="variable">$(c_obj)</span> -o glue</span><br><span class="line"><span class="section">glue.o:		<span class="variable">$(c_src)</span> <span class="variable">$(hdrs)</span></span></span><br><span class="line">	gcc <span class="variable">$(opts)</span> <span class="variable">$(c_src)</span></span><br><span class="line"><span class="section">paper:	<span class="variable">$(d_obj)</span></span></span><br><span class="line">	gcc <span class="variable">$(d_obj)</span> -o paper</span><br><span class="line"><span class="section">paper.o:	<span class="variable">$(p_src)</span> <span class="variable">$(hdrs)</span></span></span><br><span class="line">	gcc <span class="variable">$(opts)</span> <span class="variable">$(d_src)</span></span><br><span class="line"><span class="section">tobacco:	<span class="variable">$(e_obj)</span></span></span><br><span class="line">	gcc <span class="variable">$(e_obj)</span> -o tobacco</span><br><span class="line"><span class="section">tobacco.o:		<span class="variable">$(e_src)</span> <span class="variable">$(hdrs)</span></span></span><br><span class="line">	gcc <span class="variable">$(opts)</span> <span class="variable">$(e_src)</span></span><br><span class="line"><span class="section">provider:	<span class="variable">$(f_obj)</span></span></span><br><span class="line">	gcc <span class="variable">$(f_obj)</span> -o provider</span><br><span class="line"><span class="section">provider.o:		<span class="variable">$(f_src)</span> <span class="variable">$(hdrs)</span></span></span><br><span class="line">	gcc <span class="variable">$(opts)</span> <span class="variable">$(f_src)</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm glue provider paper tobaco *.o</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/28/吸烟者问题/" data-id="cjl7x6cg5000bqgumgnzj9naf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux-操作系统/">linux 操作系统</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-eclipse连接Mysql-0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/21/eclipse连接Mysql-0/" class="article-date">
  <time datetime="2018-05-21T12:01:29.000Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/21/eclipse连接Mysql-0/">eclipse连接Mysql</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、前期准备："><a href="#一、前期准备：" class="headerlink" title="一、前期准备："></a>一、前期准备：</h3><p>1.eclipse</p>
<p>2.Mysql workbench</p>
<p>3.jdbc </p>
<p>下载地址：<a href="https://www.mysql.com/products/connector/" target="_blank" rel="noopener">下载地址</a></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/1.png" alt=""></p>
<p>点击JDBC Driver for Mysql(Connector/j) 后面的下载</p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/QQ图片20180520213231.png" alt=""></p>
<p>按箭头选择</p>
<p>之后会有登录或者注册oracle的按钮，登录就行了，没有账号注册就好了。然后下载完成。</p>
<h3 id="二、搭建"><a href="#二、搭建" class="headerlink" title="二、搭建:"></a>二、搭建:</h3><p><u>将下载好的jdbc放置到指定的文件夹下。</u></p>
<p><strong>1.打开eclipse</strong></p>
<p>​    依次点击Window-preferences-java-Build Path-User Libraries </p>
<p>​    如下图所示：</p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/3.png" alt=""></p>
<p><strong>2.点击new按钮，出现如下界面：</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/4.png" alt=""></p>
<p>​       </p>
<p><strong>3.在输入框中输入jdbc，选中下面的System library，点击ok</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/5.png" alt=""></p>
<p><strong>4.回到上一级界面，点击Add External JARs，打开到你的jdbc存放的目录，打开-ok</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/7.png" alt=""></p>
<p><strong>5.接下来是项目导入jar包，项目右键-Build Path-Configure Build Path</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/6.png" alt=""></p>
<p><strong>6.点击右侧Add Library… -User Library-Next。打上对勾点击finish</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/8.png" alt=""></p>
<p><strong>7.回到上一级界面就可以看到你添加的jdbc，点击Apply再点击ok。</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/9.png" alt=""></p>
<p><strong>8.这样在你的项目下就可以看到你导入的jdbc了</strong></p>
<p><img src="/2018/05/21/eclipse连接Mysql-0/10.png" alt=""></p>
<p>jdbc配置到这里就完成了。</p>
<p><u>然后是连接的测试代码了</u></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> shiyanshi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">      Class.forName(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);     <span class="comment">//加载MYSQL JDBC驱动程序   </span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//Class.forName("org.gjt.mm.mysql.Driver");</span></span><br><span class="line"></span><br><span class="line">     System.out.println(<span class="string">"Success loading Mysql Driver!"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">      System.out.print(<span class="string">"Error loading Mysql Driver!"</span>);</span><br><span class="line"></span><br><span class="line">      e.printStackTrace();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">      Connection connect = DriverManager.getConnection(</span><br><span class="line"></span><br><span class="line">          <span class="string">"jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT"</span>,<span class="string">"root"</span>,<span class="string">"xxxxxxx"</span>);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//连接URL为   jdbc:mysql//服务器地址/数据库名  ，后面的2个参数分别是登陆用户名和密码</span></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">catch</span>(SQLException e)</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意登录用户名一般都是root，密码要改成你自己设置的密码。当连接成功时，控制台会打印成功连接的信息。</strong></p>
<p><strong>之前参考的教程因为版本的原因出现了一些问题，现在我的代码是改好的，jdk和jdbc以及各软件都是比较新的版本，应该已经没多大问题了。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/21/eclipse连接Mysql-0/" data-id="cjl7x6cev0002qgum4f6kx6yz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/环境配置类/">环境配置类</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-旋转Treap的简单实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/16/旋转Treap的简单实现/" class="article-date">
  <time datetime="2018-05-16T08:47:55.000Z" itemprop="datePublished">2018-05-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/16/旋转Treap的简单实现/">旋转Treap的简单实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Treap=Tree+Heap</p>
<p>Treap是一棵<a href="https://baike.baidu.com/item/%E4%BA%8C%E5%8F%89%E6%8E%92%E5%BA%8F%E6%A0%91" target="_blank" rel="noopener">二叉搜索树</a>，它的左子树和右子树分别是一个Treap，和一般的二叉搜索树不同的是，Treap结构中每个节点x有两个域，一个是其关键字值key，一个是优先级数priority（他是一个独立选取的随机数），对于Treap结构，其关键字遵循二叉搜索树性质，其优先级遵循堆性质。但是这里要注意的是Treap和二叉堆有一点不同，就是<a href="https://baike.baidu.com/item/%E4%BA%8C%E5%8F%89%E5%A0%86" target="_blank" rel="noopener">二叉堆</a>必须是完全二叉树，而Treap可以并不一定是。</p>
<p>  在这里用的链表实现的旋转的Treap，简单实现是思路比较简单，但代码稍微有点繁琐。有点懒，不想整理了。</p>
<p>   TreapNode结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">template&lt;class T&gt;</span><br><span class="line">struct treapNode</span><br><span class="line">&#123;</span><br><span class="line">	int key;//用于二叉搜索树的关键字 </span><br><span class="line">	int pri;//用于堆性质的优先级数字 </span><br><span class="line">	T element;//其中的元素 </span><br><span class="line">    treapNode&lt;T&gt; *leftChild,   //左子树 </span><br><span class="line">                 *rightChild,</span><br><span class="line">				 *father;  //右子树 </span><br><span class="line">   treapNode() &#123;leftChild = rightChild = father=NULL;&#125;//构造函数 </span><br><span class="line">   treapNode(const T&amp; theElement):element(theElement)</span><br><span class="line">   &#123;</span><br><span class="line">      leftChild = rightChild = father=NULL;</span><br><span class="line">   &#125;</span><br><span class="line">   treapNode(const T&amp; theElement,</span><br><span class="line">                  treapNode *theLeftChild,</span><br><span class="line">                  treapNode *theRightChild,</span><br><span class="line">				  treapNode *theFather)</span><br><span class="line">                  :element(theElement)</span><br><span class="line">   &#123;</span><br><span class="line">      leftChild = theLeftChild;</span><br><span class="line">      rightChild = theRightChild;</span><br><span class="line">      father=theFather;</span><br><span class="line">   &#125;</span><br><span class="line">	treapNode(int theKey,int thePri,T theElement)</span><br><span class="line">	&#123;</span><br><span class="line">		key=theKey;</span><br><span class="line">		pri=thePri;</span><br><span class="line">		element=theElement;</span><br><span class="line">		 leftChild = rightChild = father=NULL;</span><br><span class="line">	&#125;</span><br><span class="line">	treapNode(int theKey,T theElement)</span><br><span class="line">	&#123;</span><br><span class="line">		key=theKey;</span><br><span class="line">		pri=rand();</span><br><span class="line">		element = theElement;</span><br><span class="line">		leftChild=rightChild=father=NULL;</span><br><span class="line">	&#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在节点中加入了父节点的指针，为了后面的旋转操作能够更简单一点，不加也是可以的，不过就要稍微复杂一点了。</p>
<p>插入操作：</p>
<p>不满足：当插入的节点为其父节点的左孩子时，应该右旋，否则左旋。</p>
<p>插入方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">template&lt;class T&gt;</span><br><span class="line">void treap&lt;T&gt;::insert(treapNode&lt;T&gt; *t)//插入方法，参数为一个treap节点。 </span><br><span class="line">&#123;   t-&gt;leftChild=t-&gt;rightChild=t-&gt;father=NULL;</span><br><span class="line">	if(root==NULL)//当treap为空的时候情况 </span><br><span class="line">	  &#123;</span><br><span class="line">	   root=t;</span><br><span class="line">	   treapSize++;</span><br><span class="line">	   return ;</span><br><span class="line">      &#125;</span><br><span class="line">	else//当treap不为空的时候，要找到要删除的位置 </span><br><span class="line">	&#123;</span><br><span class="line">		treapNode&lt;T&gt; *pp=root;</span><br><span class="line">		treapNode&lt;T&gt; *p=NULL;</span><br><span class="line">		while(pp!=NULL)</span><br><span class="line">		&#123;   p=pp;</span><br><span class="line">			if(t-&gt;key&lt;pp-&gt;key)//小于关键字时 </span><br><span class="line">				pp=pp-&gt;leftChild;</span><br><span class="line">			else</span><br><span class="line">			&#123;</span><br><span class="line">				if(t-&gt;key&gt;pp-&gt;key)//大于关键字时 </span><br><span class="line">				pp=pp-&gt;rightChild;</span><br><span class="line">				else//要插入的节点已经重复时 </span><br><span class="line">				&#123;</span><br><span class="line">				pp-&gt;element=t-&gt;element;</span><br><span class="line">				treapSize--;</span><br><span class="line">				return; </span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	  if(t-&gt;key&gt;p-&gt;key)</span><br><span class="line">	  &#123;</span><br><span class="line">	   p-&gt;rightChild=t;</span><br><span class="line">	   t-&gt;father=p;</span><br><span class="line">      &#125;</span><br><span class="line">	  else</span><br><span class="line">	  &#123;</span><br><span class="line">	   p-&gt;leftChild=t;</span><br><span class="line">	   t-&gt;father=p;</span><br><span class="line">      &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	treapNode&lt;T&gt; *q=t-&gt;father;//获取插入节点的父节点 </span><br><span class="line">	//treapNode&lt;T&gt; *w=t-&gt;father;</span><br><span class="line">	int com;//判断是否循环继续的量 </span><br><span class="line">	do//采用do-while结构，保证循环至少进行一次 </span><br><span class="line">  &#123; com=0;</span><br><span class="line">	if(t-&gt;pri&lt;q-&gt;pri&amp;&amp;t-&gt;key&lt;q-&gt;key)//当优先级不满足堆的性质并且插入的节点在左孩子的位置时，此时应该右旋 </span><br><span class="line">	&#123;   if(t-&gt;rightChild!=NULL)//当插入节点的右孩子不为空的时候 </span><br><span class="line">	    &#123;</span><br><span class="line">		   q-&gt;leftChild=t-&gt;rightChild;//插入节点的右孩子变成其父节点的左孩子 </span><br><span class="line">		   t-&gt;rightChild-&gt;father=q;//插入节点的右孩子的父母指向插入节点的父母 </span><br><span class="line">		   t-&gt;rightChild=q;//父节点变为插入节点的右孩子 </span><br><span class="line">		   if(q-&gt;father!=NULL)//在这里分情况讨论，当其父节点的父节点不为空的时候 </span><br><span class="line">		   &#123;</span><br><span class="line">		   	t-&gt;father=q-&gt;father;//插入节点的父节点为其父节点的父节点</span><br><span class="line">			if(q-&gt;father-&gt;leftChild==q)//判断父节点是否是父节点的父节点的左孩子 </span><br><span class="line">		   	q-&gt;father-&gt;leftChild=t;//父节点的父节点左孩子变成插入节点 </span><br><span class="line">		   	else</span><br><span class="line">		   	q-&gt;father-&gt;rightChild=t;</span><br><span class="line">			q-&gt;father=t; //父节点的父母变成插入节点 </span><br><span class="line">		   &#125;</span><br><span class="line">		   else//当其父节点的父节点为空时 </span><br><span class="line">		   &#123;</span><br><span class="line">		   	t-&gt;father=NULL;//插入节点的父节点为空 </span><br><span class="line">		   	root=t;</span><br><span class="line">		   	q-&gt;father=t;//父节点的父母变为插入节点 </span><br><span class="line">		   &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	    else//当插入节点的右孩子为空的时候 </span><br><span class="line">	    &#123;   t-&gt;rightChild=q;</span><br><span class="line">		    if(q-&gt;father!=NULL)//当其父节点的父节点不为空时 </span><br><span class="line">		    &#123;</span><br><span class="line">			  t-&gt;father=q-&gt;father;</span><br><span class="line">			  if(q-&gt;father-&gt;leftChild==q) //判断父节点是否是父节点的父节点的左孩子</span><br><span class="line">			  q-&gt;father-&gt;leftChild=t;</span><br><span class="line">			  else</span><br><span class="line">			  q-&gt;father-&gt;rightChild=t;</span><br><span class="line">			  q-&gt;father=t; </span><br><span class="line">			  q-&gt;leftChild=NULL;</span><br><span class="line">		    &#125; </span><br><span class="line">		    else//当其父节点的父节点为空时 </span><br><span class="line">			&#123;</span><br><span class="line">				t-&gt;father=NULL;//父节点变为空 </span><br><span class="line">				root=t;//此时根节点为当前插入的节点 </span><br><span class="line">				t-&gt;rightChild=q;//插入节点的右孩子变为原来节点的父节点 </span><br><span class="line">				q-&gt;father=t; //插入节点的父节点改成当前节点 </span><br><span class="line">				q-&gt;leftChild=NULL;//插入节点的原来的父节点改为空值 </span><br><span class="line">			&#125;</span><br><span class="line">		&#125; com=1;</span><br><span class="line">	&#125;</span><br><span class="line">	if(t-&gt;pri&lt;q-&gt;pri&amp;&amp;t-&gt;key&gt;q-&gt;key)//当优先级不满足堆的性质并且插入的节点在右孩子的位置时，此时应该左旋 </span><br><span class="line">	&#123;   if(t-&gt;leftChild!=NULL)//当插入节点的左孩子不为空的时候 </span><br><span class="line">	    &#123;</span><br><span class="line">		   q-&gt;rightChild=t-&gt;leftChild;//插入节点的左孩子变成其父节点的右孩子 </span><br><span class="line">		   t-&gt;leftChild-&gt;father=q;//插入节点的左孩子的父母指向插入节点的父母 </span><br><span class="line">		   t-&gt;leftChild=q;//父节点变为插入节点的左孩子 </span><br><span class="line">		   if(q-&gt;father!=NULL)//在这里分情况讨论，当其父节点的父节点不为空的时候 </span><br><span class="line">		   &#123;</span><br><span class="line">		   	t-&gt;father=q-&gt;father;//插入节点的父节点为其父节点的父节点</span><br><span class="line">			if(q-&gt;father-&gt;leftChild==q)//判断父节点是否是父节点的父节点的左孩子 </span><br><span class="line">		   	q-&gt;father-&gt;leftChild=t;//父节点的父节点左孩子变成插入节点 </span><br><span class="line">		   	else</span><br><span class="line">		   	q-&gt;father-&gt;rightChild=t;</span><br><span class="line">			q-&gt;father=t; //父节点的父母变成插入节点 </span><br><span class="line">			</span><br><span class="line">		   &#125;</span><br><span class="line">		   else//当其父节点的父节点为空时 </span><br><span class="line">		   &#123;</span><br><span class="line">		   	t-&gt;father=NULL;//插入节点的父节点为空 </span><br><span class="line">		   	root=t;</span><br><span class="line">		   	q-&gt;father=t;//父节点的父母变为插入节点 </span><br><span class="line">		   	q-&gt;leftChild=NULL;</span><br><span class="line">		   &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	    else//当插入节点的左孩子为空的时候 </span><br><span class="line">	    &#123;   t-&gt;leftChild=q;</span><br><span class="line">		    if(q-&gt;father!=NULL)//当其父节点的父节点不为空时 </span><br><span class="line">		    &#123;</span><br><span class="line">			  t-&gt;father=q-&gt;father;</span><br><span class="line">			  if(q-&gt;father-&gt;leftChild==q) //判断父节点是否是父节点的父节点的左孩子</span><br><span class="line">			  q-&gt;father-&gt;leftChild=t;</span><br><span class="line">			  else</span><br><span class="line">			  q-&gt;father-&gt;rightChild=t;</span><br><span class="line">			  q-&gt;father=t; </span><br><span class="line">			  q-&gt;rightChild=NULL;</span><br><span class="line">		    &#125; </span><br><span class="line">		    else//当其父节点的父节点为空时 </span><br><span class="line">			&#123;</span><br><span class="line">				t-&gt;father=NULL;</span><br><span class="line">				root=t;</span><br><span class="line">				t-&gt;leftChild=q;</span><br><span class="line">				q-&gt;father=t;</span><br><span class="line">				q-&gt;rightChild=NULL; </span><br><span class="line">			&#125;</span><br><span class="line">		&#125; com=1;</span><br><span class="line">	&#125;</span><br><span class="line">	q=t-&gt;father;//更新插入节点的父节点 </span><br><span class="line">  &#125; while(q!=NULL&amp;&amp;com==1);//</span><br><span class="line">  treapSize++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>删除操作:</p>
<p>先找到要删除的节点的位置，然后判断要删除的节点的有几个孩子，然后再根据情况具体实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">template&lt;class T&gt;</span><br><span class="line">void treap&lt;T&gt;::erase(int key)</span><br><span class="line">&#123;</span><br><span class="line">	treapNode&lt;T&gt; *t=root;</span><br><span class="line">	while(t!=NULL)//首先找到要删除的节点 </span><br><span class="line">	&#123;</span><br><span class="line">		if(t-&gt;key&lt;key)</span><br><span class="line">		t=t-&gt;rightChild;</span><br><span class="line">		else</span><br><span class="line">		&#123;</span><br><span class="line">		    if(t-&gt;key&gt;key)</span><br><span class="line">			t=t-&gt;leftChild;</span><br><span class="line">			else//当相等时即找到要删除的节点了，跳出循环 </span><br><span class="line">			break;</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	if(t==NULL)//treap中没有要删除的关键字的元素 </span><br><span class="line">	&#123;</span><br><span class="line">		cout&lt;&lt;&quot;please put in correct data&quot;&lt;&lt;key&lt;&lt;&quot; &quot;;</span><br><span class="line">		return ;</span><br><span class="line">	&#125;</span><br><span class="line">	else//找到要删除的节点后 </span><br><span class="line">	&#123;</span><br><span class="line">	    treapNode&lt;T&gt; *q=t-&gt;father;//找到要删除的节点的父节点 </span><br><span class="line">	   if(t-&gt;leftChild==NULL&amp;&amp;t-&gt;rightChild==NULL)//最简单的情况：当要删除的节点为叶节点时 ，并且此种情况下优先级的顺序不会改变 </span><br><span class="line">	  &#123;</span><br><span class="line">		if(t==root)//其中的特殊情况：只有一个节点，即根节点 </span><br><span class="line">		root=NULL;</span><br><span class="line">		else//不为根节点 </span><br><span class="line">		&#123;</span><br><span class="line">			if(key&lt;q-&gt;key)//判断是左孩子还是右孩子 </span><br><span class="line">			q-&gt;leftChild=NULL;</span><br><span class="line">			else</span><br><span class="line">			q-&gt;rightChild=NULL;</span><br><span class="line">			t-&gt;father=NULL;//让此节点的父节点为空 </span><br><span class="line">			//t=NULL;//释放此节点 </span><br><span class="line">		&#125;</span><br><span class="line">	  &#125;</span><br><span class="line">	  if((t-&gt;leftChild==NULL&amp;&amp;t-&gt;rightChild!=NULL)||(t-&gt;leftChild!=NULL&amp;&amp;t-&gt;rightChild==NULL))//当要删除的节点为有一个孩子时 </span><br><span class="line">	  &#123;  </span><br><span class="line">	   if(q==NULL)//当要删除的节点为根节点时 </span><br><span class="line">	   &#123;</span><br><span class="line">	   	 if(t-&gt;leftChild!=NULL)//如果左孩子不为空 </span><br><span class="line">	   	 &#123; t-&gt;leftChild-&gt;father=NULL;</span><br><span class="line">		   root=t-&gt;leftChild;</span><br><span class="line">		   t-&gt;leftChild=NULL;</span><br><span class="line">	     &#125;</span><br><span class="line">	     else//右孩子不为空 </span><br><span class="line">	     &#123;</span><br><span class="line">	     	t-&gt;rightChild-&gt;father=NULL;</span><br><span class="line">	     	root=t-&gt;rightChild;</span><br><span class="line">	     	t-&gt;rightChild=NULL;</span><br><span class="line">		 &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">	   else//删除的节点不为根节点时 </span><br><span class="line">	   &#123;</span><br><span class="line">	  	 if(t-&gt;key&lt;q-&gt;key)//当为其左孩子时 </span><br><span class="line">		 &#123;</span><br><span class="line">		    if(t-&gt;leftChild!=NULL)//当要删除的节点的左孩子不为空时 </span><br><span class="line">			&#123;</span><br><span class="line">				q-&gt;leftChild=t-&gt;leftChild;//删除节点的父节点的左孩子指向删除节点的左孩子 </span><br><span class="line">				t-&gt;leftChild-&gt;father=q;//删除节点的左孩子的父亲指向删除节点的父亲 </span><br><span class="line">				t-&gt;leftChild=NULL;//删除节点的左孩子指针指向空 </span><br><span class="line">				t-&gt;father=NULL;//其父节点的指针指向空 </span><br><span class="line">			&#125; </span><br><span class="line">			else//当要删除的右孩子不为空时 </span><br><span class="line">			&#123;</span><br><span class="line">		       q-&gt;leftChild=t-&gt;rightChild;</span><br><span class="line">			   t-&gt;rightChild-&gt;father=q;</span><br><span class="line">			   t-&gt;rightChild=NULL;</span><br><span class="line">			   t-&gt;father=NULL;		</span><br><span class="line">		    &#125;	 </span><br><span class="line">		 &#125; </span><br><span class="line">		 else//当为其右孩子时 </span><br><span class="line">		 &#123;</span><br><span class="line">		 	if(t-&gt;leftChild!=NULL)//当要删除的节点的左孩子不为空时 </span><br><span class="line">			&#123;</span><br><span class="line">				q-&gt;rightChild=t-&gt;leftChild;</span><br><span class="line">				t-&gt;leftChild-&gt;father=q;</span><br><span class="line">				t-&gt;leftChild=NULL;</span><br><span class="line">				t-&gt;father=NULL;</span><br><span class="line">				//t=NULL;</span><br><span class="line">			&#125; </span><br><span class="line">			else//当删除的节点的右孩子不为空时 </span><br><span class="line">			&#123;</span><br><span class="line">		       q-&gt;rightChild=t-&gt;rightChild;</span><br><span class="line">			   t-&gt;rightChild-&gt;father=q;</span><br><span class="line">			   t-&gt;rightChild=NULL;</span><br><span class="line">			   t-&gt;father=NULL;</span><br><span class="line">			   //t=NULL;		</span><br><span class="line">		    &#125;	 </span><br><span class="line">		 &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">     &#125;</span><br><span class="line">	  if(t-&gt;leftChild!=NULL&amp;&amp;t-&gt;rightChild!=NULL)//左右孩子均不为空的情况 </span><br><span class="line">	  &#123; </span><br><span class="line">	  	if(t-&gt;leftChild-&gt;pri&lt;t-&gt;rightChild-&gt;pri)//找出左右孩子中优先级较小的那个 </span><br><span class="line">		  &#123;treapNode&lt;T&gt; *p=t-&gt;leftChild;//记录下当前节点的左孩子 </span><br><span class="line">		  	if(p-&gt;rightChild==NULL)//当左孩子的右孩子为空时 </span><br><span class="line">			  &#123;</span><br><span class="line">			  	if(q==NULL)//如果待删节点为根节点 </span><br><span class="line">				  &#123;</span><br><span class="line">				  	p-&gt;rightChild=t-&gt;rightChild;</span><br><span class="line">					p-&gt;father=NULL;</span><br><span class="line">					t-&gt;rightChild-&gt;father=p;</span><br><span class="line">					t-&gt;leftChild=t-&gt;rightChild=NULL;</span><br><span class="line">					//t=NULL;</span><br><span class="line">					root=p;   </span><br><span class="line">				  &#125;</span><br><span class="line">				else//待删节点不为根节点 </span><br><span class="line">				&#123;</span><br><span class="line">					p-&gt;rightChild=t-&gt;rightChild;</span><br><span class="line">					t-&gt;rightChild-&gt;father=p;</span><br><span class="line">					 p-&gt;father=q;</span><br><span class="line">					 if(q-&gt;leftChild==t)</span><br><span class="line">					 q-&gt;leftChild=p;</span><br><span class="line">					 else</span><br><span class="line">					 q-&gt;rightChild=p;</span><br><span class="line">					 t-&gt;father=t-&gt;leftChild=t-&gt;rightChild=NULL;</span><br><span class="line">					 //t=NULL;</span><br><span class="line">				&#125;</span><br><span class="line">			  	</span><br><span class="line">			  &#125;</span><br><span class="line">			else//当左孩子的右孩子不为空时 </span><br><span class="line">			 &#123;</span><br><span class="line">			   	t-&gt;father=p;</span><br><span class="line">			   	t-&gt;leftChild=p-&gt;rightChild;</span><br><span class="line">			   	p-&gt;rightChild-&gt;father=t;</span><br><span class="line">			   	p-&gt;rightChild=t;</span><br><span class="line">			   	if(q==NULL)</span><br><span class="line">				 &#123;</span><br><span class="line">				   	p-&gt;father=NULL;</span><br><span class="line">				   	root=p;</span><br><span class="line">				 &#125;</span><br><span class="line">				else</span><br><span class="line">				 &#123;</span><br><span class="line">				     p-&gt;father=q;</span><br><span class="line">				     if(q-&gt;leftChild==t)</span><br><span class="line">				     q-&gt;leftChild=p;</span><br><span class="line">				     else</span><br><span class="line">				     q-&gt;rightChild=p;</span><br><span class="line">				 &#125;</span><br><span class="line">				 erase(key);</span><br><span class="line">			 &#125;</span><br><span class="line">		  &#125;</span><br><span class="line">		  else//找出左右孩子中优先级较小的那个 </span><br><span class="line">		  &#123;treapNode&lt;T&gt; *p=t-&gt;rightChild;//记录下当前节点的右孩子 </span><br><span class="line">		  	if(t-&gt;rightChild-&gt;leftChild==NULL)//当右孩子的左孩子为空时 </span><br><span class="line">			  &#123;</span><br><span class="line">			  	if(q==NULL)//如果待删节点为根节点 </span><br><span class="line">				  &#123;</span><br><span class="line">				  	p-&gt;leftChild=t-&gt;leftChild;</span><br><span class="line">					p-&gt;father=NULL;</span><br><span class="line">					t-&gt;leftChild-&gt;father=p;</span><br><span class="line">					t-&gt;leftChild=t-&gt;rightChild=NULL;</span><br><span class="line">					//t=NULL;</span><br><span class="line">					root=p;   </span><br><span class="line">				  &#125;</span><br><span class="line">				else//待删节点不为根节点 </span><br><span class="line">				&#123;</span><br><span class="line">					p-&gt;leftChild=t-&gt;leftChild;</span><br><span class="line">					t-&gt;leftChild-&gt;father=p;</span><br><span class="line">					 p-&gt;father=q;</span><br><span class="line">					 if(q-&gt;leftChild==t)</span><br><span class="line">					 q-&gt;leftChild=p;</span><br><span class="line">					 else</span><br><span class="line">					 q-&gt;rightChild=p;</span><br><span class="line">					 t-&gt;father=t-&gt;leftChild=t-&gt;rightChild=NULL;</span><br><span class="line">					 //t=NULL;</span><br><span class="line">				&#125;</span><br><span class="line">			  	</span><br><span class="line">			  &#125;</span><br><span class="line">			else//当右孩子的左孩子不为空时 </span><br><span class="line">			 &#123;</span><br><span class="line">			   	t-&gt;father=p;</span><br><span class="line">			   	t-&gt;rightChild=p-&gt;leftChild;</span><br><span class="line">			   	p-&gt;leftChild-&gt;father=t;</span><br><span class="line">			   	p-&gt;leftChild=t;</span><br><span class="line">			   	if(q==NULL)</span><br><span class="line">				 &#123;</span><br><span class="line">				   	p-&gt;father=NULL;</span><br><span class="line">				   	root=p;</span><br><span class="line">				 &#125;</span><br><span class="line">				else</span><br><span class="line">				 &#123;</span><br><span class="line">				     p-&gt;father=q;</span><br><span class="line">				     if(q-&gt;leftChild==t)</span><br><span class="line">				     q-&gt;leftChild=p;</span><br><span class="line">				     else</span><br><span class="line">				     q-&gt;rightChild=p;</span><br><span class="line">				 &#125;</span><br><span class="line">				 erase(key);</span><br><span class="line">			 &#125;</span><br><span class="line">		  &#125;</span><br><span class="line">	  &#125; </span><br><span class="line">	  treapSize--;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/16/旋转Treap的简单实现/" data-id="cjl7x6cel0001qgumi96im82w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-计算机图形学-opencv-Java/">Android 计算机图形学 opencv Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-操作系统/">linux 操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/拓扑排序-有向图/">拓扑排序 有向图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/环境配置类/">环境配置类</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android-计算机图形学-opencv-Java/" style="font-size: 10px;">Android 计算机图形学 opencv Java</a> <a href="/tags/linux-操作系统/" style="font-size: 10px;">linux 操作系统</a> <a href="/tags/拓扑排序-有向图/" style="font-size: 10px;">拓扑排序 有向图</a> <a href="/tags/环境配置类/" style="font-size: 10px;">环境配置类</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/06/10/社区医院选址问题/">社区医院选址问题</a>
          </li>
        
          <li>
            <a href="/2018/06/10/基于拓扑排序的排课程序/">基于拓扑排序的排课程序</a>
          </li>
        
          <li>
            <a href="/2018/06/04/Android手指个数识别/">Android手指个数识别</a>
          </li>
        
          <li>
            <a href="/2018/05/28/吸烟者问题/">吸烟者问题</a>
          </li>
        
          <li>
            <a href="/2018/05/21/eclipse连接Mysql-0/">eclipse连接Mysql</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>